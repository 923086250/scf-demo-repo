<!-- <!DOCTYPE html> -->
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Invitation-Demo</title>
</head>

<body>
    <h1>提交：姓名</h1>
    <div id='textContainer'>
        <form id="uploadForm" type="text/javascript">
            姓名：<input type="text" value="" id='textId' class="textClass" name="textName"/>
            <input type="button" value="提交" id='btnAjax'/>
        </form>
    </div>
    <script type="text/javascript">
                
         // 綁定點擊事件
        document.querySelector('#btnAjax').onclick = function () {
            // 更改後端服務網址
            var url="https://service-1c2dsqdi-1255721742.gz.apigw.taifucloudcs.com/release/test-123456";
             // 異步對象
            var ajaxObj = new XMLHttpRequest();
            // 設置屬性
            ajaxObj.open("POST",url,"false");
            // 如果想要使用post提交數據,必須添加此行
            ajaxObj.setRequestHeader("Content-type", "application/x-www-form-urlencoded;charset=UTF-8","Origin");
            // 将數據通過send方法傳遞
            var value = document.getElementById("textId").value 
            console.log(value);
            ajaxObj.send(value);
            // 發送並接受返回值
            ajaxObj.onreadystatechange = function () {
                // 這步爲判斷服務器是否正确響應
                if (ajaxObj.readyState == 4 && ajaxObj.status == 200) {
                    console.log('數據返回成功');
                    // alert(ajaxObj.responseText);
                    // 修改頁面的顯示
                    document.querySelector('h2').innerHTML = ajaxObj.responseText;
                    // 圖片展示
                    var url_jpg = ajaxObj.responseText; 
                    xmlhttp = new XMLHttpRequest();
                    xmlhttp.open("GET",url_jpg,true);
                    xmlhttp.responseType = "blob";
                    xmlhttp.onload = function(){
                        if (this.status == 200) {
                            var blob = this.response;
                            var img = document.createElement("img");
                            img.onload = function(e) {
                                window.URL.revokeObjectURL(img.src); 
                            };
                            img.src = window.URL.createObjectURL(blob);
                            document.body.appendChild(img); 
                        }
                    }
                    xmlhttp.send();
                }
                else{
                    // alert(ajaxObj.responseText);
                    document.querySelector('h2').innerHTML = ajaxObj.responseText;
                }
            };
        }
    </script>    

    <hr>
    <h2>雲函數處理後返回：下載連結</h2>
    <div id="showContainer" style="width:200px;">
        <!-- <p class="loadingTips" style="display: none;">處理中...</p> -->
    </div>

    <hr>
    <h3>邀請函展示</h2>
    <div id="showContainer" style="width:800px;">
        <!-- <p class="loadingTips" style="display: none;">處理中...</p> -->
    </div>
</body>
</html>